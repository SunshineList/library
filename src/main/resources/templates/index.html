<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/><!-- 标题栏LOGO -->
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<!--字体图标-->
<link href="../javaex/pc/css/icomoon.css" rel="stylesheet" />
<!--动画-->
<link href="../javaex/pc/css/animate.css" rel="stylesheet" />
<!--骨架样式-->
<link href="../javaex/pc/css/common.css" rel="stylesheet" />
<!--皮肤（缇娜）-->
<link href="../javaex/pc/css/skin/tina.css" rel="stylesheet" />
<!--jquery，不可修改版本-->
<script src="../javaex/pc/lib/jquery-1.7.2.min.js"></script>
<!--全局动态修改-->
<script src="../javaex/pc/js/common.js"></script>
<!--核心组件-->
<script src="../javaex/pc/js/javaex.min.js"></script>
<!--表单验证-->
<script src="../javaex/pc/js/javaex-formVerify.js"></script>
<title>后台管理</title>
<style>
	.title_font{
		font-size: 22px;
	}
</style>
</head>
<body>
	<!--顶部导航-->
	<div class="admin-navbar">
		<div class="admin-container-fluid clear">
			<!--logo名称-->
			<div class="admin-logo">公共图书馆管理系统</div>
			
			<!--右侧-->
			<ul class="admin-navbar-nav fr">
				<li>
					<a href="javascript:;">欢迎您，<span id="nickname">超级管理员</span></a>
					<ul class="dropdown-menu" style="right: 10px;">
						<li><a href="/logout">退出当前账号</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	
	<!--主题内容-->
	<div class="admin-mian">
		<!--左侧菜单-->
		<div class="admin-aside admin-aside-fixed">
            <!-- 应用标题  -->
			<div id="admin-toc" class="admin-toc">
				<div class="menu-box">
					<div id="menu" class="menu">
						<ul>
                            <li class="menu-item hover">
								<a href="javascript:page('welcome');"><i class="icon-home2"></i><span class="title_font">首页</span></a>
							</li>

							<li class="menu-item" id="book">
                                <a href="javascript:;">图书管理<i class="icon-keyboard_arrow_left"></i></a>
                                <ul>
									<li><a id="book-list" href="javascript:page('book/book-list');">图书列表</a></li>
									<li><a id="add-book" href="javascript:page('book/book-add');">图书上架</a></li>
								</ul>
                            </li>

							<li class="menu-item" id="journal">
								<a href="javascript:;">期刊管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="journal-list" href="javascript:page('journal/journal-list');">期刊列表</a></li>
									<li><a id="add-journal" href="javascript:page('journal/journal-add');">期刊上架</a></li>
<!--									<li><a id="journal-statistics" href="javascript:page('statistics/journal');">期刊统计</a></li>-->
								</ul>
							</li>
                            
							<li class="menu-item" id="borrow">
								<a href="javascript:;">图书借阅管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="book-search" href="javascript:page('borrow/book-search');">借阅图书</a></li>
<!--                                    <li><a id="book-borrow" href="javascript:page('borrow/borrow');">借阅图书</a></li>-->
                                    <li><a id="book-back" href="javascript:page('borrow/back');">归还图书</a></li>
								</ul>
                            </li>

							<li class="menu-item" id="journal_borrow">
								<a href="javascript:;">期刊借阅管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="journal-search" href="javascript:page('journal_borrow/search');">借阅期刊</a></li>
<!--									<li><a id="journal-borrow" href="javascript:page('journal_borrow/borrow');">借阅期刊</a></li>-->
									<li><a id="journal-back" href="javascript:page('journal_borrow/back');">归还期刊</a></li>
								</ul>
							</li>

                            <li class="menu-item" id="reader">
								<a href="javascript:;">读者管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="reader-list" href="javascript:page('reader/reader-list');">读者列表</a></li>
                                    <li><a id="reader-add" href="javascript:page('reader/reader-add');">读者添加</a></li>
								</ul>
                            </li>

							<li class="menu-item" id="purchase">
								<a href="javascript:;">采购管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="purchase-list" href="javascript:page('purchase/purchase-list');">采购记录列表</a></li>
									<li><a id="purchase-add" href="javascript:page('purchase/purchase-add');">采购</a></li>
								</ul>
							</li>
                            
                            <li class="menu-item" id="user">
								<a href="javascript:;">用户中心<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="user-info" href="javascript:page('user/user-info');">个人信息</a></li>
                                    <li><a id="user-manage" href="javascript:page('user/user-list');">用户管理</a></li>
                                    <li><a id="admin-add" href="javascript:page('user/user-add');">添加Vip读者</a></li>
								</ul>
							</li>


							<li class="menu-item" id="log_m">
								<a href="javascript:;">日志管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="log" href="javascript:page('borrow/log');">图书借阅日志</a></li>
									<li><a id="journal_log" href="javascript:page('journal_borrow/log');">期刊借阅日志</a></li>
								</ul>
							</li>

							<li class="menu-item" id="statistics">
								<a href="javascript:;">统计管理<i class="icon-keyboard_arrow_left"></i></a>
								<ul>
									<li><a id="book-statistics" href="javascript:page('statistics/demo');">图书统计</a></li>
									<li><a id="question-statistics" href="javascript:page('statistics/question');">问卷统计</a></li>
								</ul>
							</li>

							<li class="menu-item" id="question">
								<a id="ques" href="javascript:page('question/index');">调查问卷</i></a>
							</li>

							<li class="menu-item" id="person">
								<a href="javascript:page('borrow/back');">个人中心</i></a>
							</li>


						</ul>
					</div>
				</div>
			</div>
		</div>
		
		<!--iframe载入内容-->
		<div class="admin-markdown">
			<iframe id="page" src="welcome"></iframe>
		</div>
	</div>
</body>
<script>
	var hightUrl = "xxxx";
	javaex.menu({
		id : "menu",
		isAutoSelected : true,
		key : "",
		url : hightUrl
	});
	
	$(function() {
		// 设置左侧菜单高度
		setMenuHeight();
	});
	
	/**
	 * 设置左侧菜单高度
	 */
	function setMenuHeight() {
		var height = document.documentElement.clientHeight - $("#admin-toc").offset().top;
		height = height - 10;
		$("#admin-toc").css("height", height+"px");
	}
	
	// 控制页面载入
	function page(url) {
		$("#page").attr("src", url);
	}

    $(document).ready(function(){
        // 页面一加载, 读取登录用户信息, 进行权限限制
        $.get("/user/currUser", function(data){
            var code = data.code;
            var user = data.data;

            $.get("question/is_over", {"user_id": user.id}, (data)=>{
            	if (data.code == 111){
            		$("#question").hide()
				}
			})

            if (code === 200) {
                // 设置用户昵称
                $("#nickname").text(user.nickname);
				// 根据用户权限, 控制用户可见菜单
                var auth = user.identity;

				if (auth === 0){ // 普通读者
					$("#add-book").hide()
					$("#add-journal").hide()
					$("#reader").hide()
					$("#log_m").hide()
					$("#user").hide()
					$("#purchase").hide()
					$("#statistics").hide()
				}

            	if (auth === 1){ // vip读者
					$("#add-book").hide()
					$("#add-journal").hide()
					$("#reader").hide()
					$("#log_m").hide()
					$("#user").hide()
					$("#purchase").hide()
					$("#statistics").hide()
				}

            	if (auth === 2){  // 图书管理员
					$("#borrow").hide()
					$("#journal_borrow").hide()
					$("#reader").hide()
					$("#log_m").hide()
					$("#user").hide()
					$("#purchase").hide()
					$("#question").hide()
					$("#question-statistics").hide()
					$("#person").hide()
				}

                if (auth === 4){  // 采购员
					$("#add-book").hide()
					$("#add-journal").hide()
					$("#reader").hide();
					$("#user").hide();
					$("#borrow").hide();
					$("#log_m").hide();
					$("#journal_borrow").hide();
					$("#question").hide()
					$("#statistics").hide()
					$("#person").hide()
				}

                if (auth === 3){
                	$("#question").hide()
					$("#person").hide()
				}
			}

            return false;
        });
    });
</script>
</html>